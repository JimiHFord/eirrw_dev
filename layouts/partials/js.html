{{/* Asset bundles */}}

{{ $assets := newScratch }}

{{ if hugo.IsProduction }}
  <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.13.1/fh-3.3.1/r-2.4.0/rg-1.3.0/datatables.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/js/selectize.min.js"
    integrity="sha512-IOebNkvA/HZjMM7MxL0NYeLYEalloZ8ckak+NDtOViP7oiYzG5vn6WVXyrJDiJPhl4yRdmNAG49iuLmhkUdVsQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
{{ else }}
  <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/v/dt/dt-1.13.1/fh-3.3.1/r-2.4.0/rg-1.3.0/datatables.js" type="text/javascript"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/js/selectize.js"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
{{ end }}

{{ $jsAppearance := resources.Get "js/appearance.js" }}
{{ $jsAppearance = $jsAppearance | resources.Minify | resources.Fingerprint "sha512" }}
<script src="{{ $jsAppearance.RelPermalink }}" type="text/javascript" integrity="{{ $jsAppearance.Data.Integrity }}"></script>
{{ if .Site.Params.enableSearch | default false }}
  {{ $jsFuse := resources.Get "lib/fuse/fuse.min.js" }}
  {{ $jsSearch := resources.Get "js/search.js" }}
  {{ $assets.Add "js" (slice $jsFuse $jsSearch) }}
{{ end }}
{{ if .Site.Params.enableCodeCopy | default false }}
  {{ $jsCode := resources.Get "js/code.js" }}
  {{ $assets.Add "js" (slice $jsCode) }}
{{ end }}
{{ if .Site.Params.rtl | default false }}
  {{ $jsRTL := resources.Get "js/rtl.js" }}
  {{ $assets.Add "js" (slice $jsRTL) }}
{{ end }}
{{ if $assets.Get "js" }}
  {{ $bundleJS := $assets.Get "js" | resources.Concat "js/main.bundle.js" | resources.Minify | resources.Fingerprint "sha512" }}
  <script defer 
    src="{{ $bundleJS.RelPermalink }}" integrity="{{ $bundleJS.Data.Integrity }}"
    type="text/javascript" id="script-bundle"
    data-copy="{{ i18n "code.copy" }}" data-copied="{{ i18n "code.copied" }}">
  </script>
{{ end }}

{{/* custom JS */}}
{{ $minify := false }}
{{ if hugo.IsProduction }}
  {{ $minify = true }}
{{ end }}

{{ $shims := dict "jquery" "js/shims/jquery.js" }}

{{ $opts := dict "targetPath" "js/main.js" "shims" $shims "minify" $minify }}
{{ if not hugo.IsProduction }}
  {{ $opts := merge $opts (dict "sourceMap" "external") }}
{{ end }}

{{ $js := resources.Get "ts/main.ts" | js.Build $opts | resources.Fingerprint "sha512" }}
<script defer src="{{ $js.RelPermalink }}" type="text/javascript" integrity="{{ $js.Data.Intgrity }}"></script>
